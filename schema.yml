openapi: 3.0.3
info:
  title: Teacher Plus Backend API
  version: 1.0.0
  description: API for the Teacher Plus application
paths:
  /api/ai/chat/:
    post:
      operationId: chatWithAI
      description: "\n        Envia uma mensagem de chat e recebe uma resposta completa\
        \ (não-streaming).\n\n        **Uso**: Para respostas rápidas ou quando streaming\
        \ não é necessário.\n        **Limitações**: Não suporta tool calls interativos\
        \ ou geração de plano de estudos.\n        **Alternativa**: Use /api/ai/chat/sse/\
        \ para funcionalidades completas com streaming.\n        "
      tags:
      - api
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ChatRequest'
          application/x-www-form-urlencoded:
            schema:
              $ref: '#/components/schemas/ChatRequest'
          multipart/form-data:
            schema:
              $ref: '#/components/schemas/ChatRequest'
        required: true
      security:
      - cookieAuth: []
      responses:
        '200':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ChatResponse'
          description: ''
        '400':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ChatRequest'
          description: ''
  /api/ai/chat/stream/:
    post:
      operationId: streamChatWithAI
      description: "\n        Estabelece uma conexão Server-Sent Events (SSE) para\
        \ streaming de respostas de chat.\n\n        **Funcionalidades**:\n      \
        \  - Streaming em tempo real com eventos estruturados\n        - Suporte a\
        \ tool calls (ex: commit_user_context para onboarding)\n        - Geração\
        \ automática de plano de estudos após commit\n        - Controle de sessão\
        \ com meta-eventos\n\n        **Eventos SSE**:\n        - `meta`: Controle\
        \ da sessão (started, committed, finished)\n        - `token`: Fragmentos\
        \ de texto gerado\n        - `heartbeat`: Progresso durante tool calls\n \
        \       - `error`: Tratamento de erros\n\n        **Fluxo típico**: session_started\
        \ → tokens (assistant_response) → [tool calls] → [plan generation] → session_finished\n\
        \        "
      tags:
      - api
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ChatRequest'
          application/x-www-form-urlencoded:
            schema:
              $ref: '#/components/schemas/ChatRequest'
          multipart/form-data:
            schema:
              $ref: '#/components/schemas/ChatRequest'
        required: true
      security:
      - cookieAuth: []
      responses:
        '200':
          content:
            application/json:
              schema:
                description: Server-Sent Events stream of chat response
          description: ''
  /api/ai/index/:
    post:
      operationId: indexDocument
      description: Ingests a document, chunks it, embeds the chunks, and stores them.
      tags:
      - api
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DocumentIngest'
          application/x-www-form-urlencoded:
            schema:
              $ref: '#/components/schemas/DocumentIngest'
          multipart/form-data:
            schema:
              $ref: '#/components/schemas/DocumentIngest'
        required: true
      security:
      - cookieAuth: []
      responses:
        '201':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DocumentIngestResponse'
          description: ''
        '400':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DocumentIngest'
          description: ''
  /api/ai/jobs/{job_id}/:
    get:
      operationId: jobStatus
      description: Consulta status de um job Celery.
      parameters:
      - in: path
        name: job_id
        schema:
          type: string
        required: true
      tags:
      - api
      security:
      - cookieAuth: []
      responses:
        '200':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/JobStatus'
          description: ''
  /api/ai/jobs/stream/:
    get:
      operationId: jobStatusStream
      description: SSE que streama mudancas de status de um job Celery.
      parameters:
      - in: query
        name: job_id
        schema:
          type: string
        description: Job ID a acompanhar
        required: true
      tags:
      - api
      security:
      - cookieAuth: []
      responses:
        '200':
          content:
            application/json:
              schema:
                description: SSE com status do job
          description: ''
  /api/ai/search/:
    get:
      operationId: searchDocuments
      description: Performs a semantic search based on the query.
      parameters:
      - in: query
        name: k
        schema:
          type: integer
          default: 5
        description: Number of results to return
      - in: query
        name: q
        schema:
          type: string
        description: Search query
        required: true
      tags:
      - api
      security:
      - cookieAuth: []
      responses:
        '200':
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/SearchResult'
          description: ''
        '400':
          content:
            application/json:
              schema:
                description: Missing query parameter
          description: ''
  /api/ai/study-plans/:
    get:
      operationId: listStudyPlans
      description: Lista os planos de estudo do usuario autenticado.
      tags:
      - api
      security:
      - cookieAuth: []
      responses:
        '200':
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/StudyPlanSummary'
          description: ''
  /api/ai/study-plans/{plan_id}/:
    get:
      operationId: getStudyPlan
      description: Retorna um plano de estudo com secoes e tarefas.
      parameters:
      - in: path
        name: plan_id
        schema:
          type: string
          format: uuid
        required: true
      tags:
      - api
      security:
      - cookieAuth: []
      responses:
        '200':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StudyPlan'
          description: ''
  /api/ai/study-plans/{plan_id}/days/:
    post:
      operationId: createStudyPlanDay
      description: Cria um novo dia no plano e opcionalmente aciona a IA para gerar
        tarefas sob demanda.
      parameters:
      - in: path
        name: plan_id
        schema:
          type: string
          format: uuid
        required: true
      tags:
      - api
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateStudyDayRequest'
          application/x-www-form-urlencoded:
            schema:
              $ref: '#/components/schemas/CreateStudyDayRequest'
          multipart/form-data:
            schema:
              $ref: '#/components/schemas/CreateStudyDayRequest'
      security:
      - cookieAuth: []
      responses:
        '201':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CreateStudyDayResponse'
          description: ''
  /api/ai/study-plans/{plan_id}/days/{day_id}/generate/:
    post:
      operationId: generateStudyDay
      description: Gera ou regenera as tarefas de um dia especifico do plano de forma
        assincrona.
      parameters:
      - in: path
        name: day_id
        schema:
          type: string
          format: uuid
        required: true
      - in: path
        name: plan_id
        schema:
          type: string
          format: uuid
        required: true
      tags:
      - api
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GenerateDayRequest'
          application/x-www-form-urlencoded:
            schema:
              $ref: '#/components/schemas/GenerateDayRequest'
          multipart/form-data:
            schema:
              $ref: '#/components/schemas/GenerateDayRequest'
      security:
      - cookieAuth: []
      responses:
        '202':
          content:
            application/json:
              schema:
                type: object
                properties:
                  job_id:
                    type: string
                  plan_id:
                    type: string
                  day_id:
                    type: string
          description: ''
  /api/ai/study-plans/{plan_id}/days/{day_id}/results/:
    post:
      operationId: recordStudyDayResult
      description: Persiste resultados agregados de um dia (status, notas, minutos,
        score).
      parameters:
      - in: path
        name: day_id
        schema:
          type: string
          format: uuid
        required: true
      - in: path
        name: plan_id
        schema:
          type: string
          format: uuid
        required: true
      tags:
      - api
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/StudyDayResult'
          application/x-www-form-urlencoded:
            schema:
              $ref: '#/components/schemas/StudyDayResult'
          multipart/form-data:
            schema:
              $ref: '#/components/schemas/StudyDayResult'
      security:
      - cookieAuth: []
      responses:
        '200':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StudyDay'
          description: ''
  /api/ai/study-plans/{plan_id}/materials/:
    post:
      operationId: uploadStudyPlanMaterial
      description: Faz upload de arquivo, associa ao plano e o ingere no RAG (Document
        + chunks).
      parameters:
      - in: path
        name: plan_id
        schema:
          type: string
          format: uuid
        required: true
      tags:
      - api
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PlanMaterialUpload'
          application/x-www-form-urlencoded:
            schema:
              $ref: '#/components/schemas/PlanMaterialUpload'
          multipart/form-data:
            schema:
              $ref: '#/components/schemas/PlanMaterialUpload'
        required: true
      security:
      - cookieAuth: []
      responses:
        '201':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PlanMaterialUploadResponse'
          description: ''
  /api/ai/study-plans/{plan_id}/tasks/:
    post:
      operationId: generateSectionTasks
      description: Gera e persiste novas tarefas para uma secao especifica do plano.
      parameters:
      - in: path
        name: plan_id
        schema:
          type: string
          format: uuid
        required: true
      tags:
      - api
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GenerateTasksRequest'
          application/x-www-form-urlencoded:
            schema:
              $ref: '#/components/schemas/GenerateTasksRequest'
          multipart/form-data:
            schema:
              $ref: '#/components/schemas/GenerateTasksRequest'
        required: true
      security:
      - cookieAuth: []
      responses:
        '201':
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/StudyTask'
          description: ''
  /api/ai/study-plans/{plan_id}/weeks/:
    get:
      operationId: listStudyPlanWeeks
      description: Retorna apenas o esqueleto semanal (foco/status/dias) de um plano
        de estudos.
      parameters:
      - in: path
        name: plan_id
        schema:
          type: string
          format: uuid
        required: true
      tags:
      - api
      security:
      - cookieAuth: []
      responses:
        '200':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StudyPlanWeekOverview'
          description: ''
  /api/ai/study-plans/generate/:
    post:
      operationId: generateStudyPlan
      description: Gera um plano de estudo + tarefas iniciais via IA, persistindo
        secoes e tarefas.
      tags:
      - api
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GeneratePlanRequest'
          application/x-www-form-urlencoded:
            schema:
              $ref: '#/components/schemas/GeneratePlanRequest'
          multipart/form-data:
            schema:
              $ref: '#/components/schemas/GeneratePlanRequest'
      security:
      - cookieAuth: []
      responses:
        '201':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StudyPlan'
          description: ''
  /api/ai/study-tasks/{task_id}/progress/:
    post:
      operationId: updateStudyTaskProgress
      description: Atualiza status/progresso de uma tarefa (flashcards, quiz, leitura,
        etc.) e recalcula o status do dia.
      parameters:
      - in: path
        name: task_id
        schema:
          type: string
          format: uuid
        required: true
      tags:
      - api
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TaskProgressRequest'
          application/x-www-form-urlencoded:
            schema:
              $ref: '#/components/schemas/TaskProgressRequest'
          multipart/form-data:
            schema:
              $ref: '#/components/schemas/TaskProgressRequest'
        required: true
      security:
      - cookieAuth: []
      responses:
        '200':
          content:
            application/json:
              schema:
                type: object
                properties:
                  task_id:
                    type: string
                  plan_id:
                    type: string
                  day_id:
                    type: string
                  status:
                    type: string
                  day_status:
                    type: string
                  metadata:
                    type: object
          description: ''
  /api/login/:
    post:
      operationId: loginUser
      description: Authenticates a user and sets access and refresh tokens as cookies.
      tags:
      - api
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Login'
          application/x-www-form-urlencoded:
            schema:
              $ref: '#/components/schemas/Login'
          multipart/form-data:
            schema:
              $ref: '#/components/schemas/Login'
        required: true
      security:
      - {}
      responses:
        '200':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LoginResponse'
          description: ''
        '401':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LoginResponse'
          description: ''
  /api/logout/:
    post:
      operationId: logoutUser
      description: Logs out the user by deleting access and refresh token cookies.
      tags:
      - api
      security:
      - {}
      responses:
        '200':
          content:
            application/json:
              schema:
                description: Logged out successfully
          description: ''
  /api/me/:
    get:
      operationId: getCurrentUser
      description: Retrieves the current authenticated user's data.
      tags:
      - api
      security:
      - cookieAuth: []
      responses:
        '200':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserRead'
          description: ''
  /api/refresh/:
    post:
      operationId: refreshUserToken
      description: Refreshes the access token using the refresh token from cookies.
      tags:
      - api
      security:
      - {}
      responses:
        '200':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RefreshResponse'
          description: ''
        '401':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RefreshResponse'
          description: ''
  /api/study-context/:
    get:
      operationId: getStudyContext
      description: Retrieves the current authenticated user's context if it exists.
      tags:
      - api
      security:
      - cookieAuth: []
      responses:
        '200':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StudyContext'
          description: ''
        '404':
          content:
            application/json:
              schema:
                description: Study context not found
          description: ''
    post:
      operationId: upsertStudyContext
      description: Updates or creates user context information.
      tags:
      - api
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/StudyContext'
          application/x-www-form-urlencoded:
            schema:
              $ref: '#/components/schemas/StudyContext'
          multipart/form-data:
            schema:
              $ref: '#/components/schemas/StudyContext'
        required: true
      security:
      - cookieAuth: []
      responses:
        '200':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StudyContext'
          description: ''
        '201':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StudyContext'
          description: ''
        '400':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StudyContext'
          description: ''
  /api/user-context/:
    get:
      operationId: getStudyContext_2
      description: Retrieves the current authenticated user's context if it exists.
      tags:
      - api
      security:
      - cookieAuth: []
      responses:
        '200':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StudyContext'
          description: ''
        '404':
          content:
            application/json:
              schema:
                description: Study context not found
          description: ''
    post:
      operationId: upsertStudyContext_2
      description: Updates or creates user context information.
      tags:
      - api
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/StudyContext'
          application/x-www-form-urlencoded:
            schema:
              $ref: '#/components/schemas/StudyContext'
          multipart/form-data:
            schema:
              $ref: '#/components/schemas/StudyContext'
        required: true
      security:
      - cookieAuth: []
      responses:
        '200':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StudyContext'
          description: ''
        '201':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StudyContext'
          description: ''
        '400':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StudyContext'
          description: ''
  /api/users/:
    get:
      operationId: listUsers
      description: Retrieves a list of all users.
      tags:
      - api
      responses:
        '200':
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/UserRead'
          description: ''
    post:
      operationId: createUser
      description: Creates a new user.
      tags:
      - api
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserWrite'
          application/x-www-form-urlencoded:
            schema:
              $ref: '#/components/schemas/UserWrite'
          multipart/form-data:
            schema:
              $ref: '#/components/schemas/UserWrite'
        required: true
      security:
      - {}
      responses:
        '201':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserRead'
          description: ''
        '400':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserWrite'
          description: ''
  /api/users/{id}/:
    get:
      operationId: retrieveUser
      description: Retrieves details of a specific user.
      parameters:
      - in: path
        name: id
        schema:
          type: string
          format: uuid
        required: true
      tags:
      - api
      security:
      - cookieAuth: []
      responses:
        '200':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserRead'
          description: ''
    put:
      operationId: updateUser
      description: Updates details of a specific user.
      parameters:
      - in: path
        name: id
        schema:
          type: string
          format: uuid
        required: true
      tags:
      - api
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserWrite'
          application/x-www-form-urlencoded:
            schema:
              $ref: '#/components/schemas/UserWrite'
          multipart/form-data:
            schema:
              $ref: '#/components/schemas/UserWrite'
        required: true
      security:
      - cookieAuth: []
      responses:
        '200':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserRead'
          description: ''
        '400':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserWrite'
          description: ''
    delete:
      operationId: deleteUser
      description: Deletes a specific user.
      parameters:
      - in: path
        name: id
        schema:
          type: string
          format: uuid
        required: true
      tags:
      - api
      security:
      - cookieAuth: []
      responses:
        '204':
          content:
            application/json:
              schema:
                description: User deleted successfully
          description: ''
components:
  schemas:
    ChatMessage:
      type: object
      properties:
        role:
          $ref: '#/components/schemas/RoleEnum'
        content:
          type: string
      required:
      - content
      - role
    ChatRequest:
      type: object
      properties:
        messages:
          type: array
          items:
            $ref: '#/components/schemas/ChatMessage'
        stream:
          type: boolean
          default: false
      required:
      - messages
    ChatResponse:
      type: object
      properties:
        reply:
          type: string
      required:
      - reply
    CreateStudyDayRequest:
      type: object
      properties:
        week_id:
          type: string
          format: uuid
          nullable: true
        scheduled_date:
          type: string
          format: date
          nullable: true
        title:
          type: string
        focus:
          type: string
        target_minutes:
          type: integer
          minimum: 0
        goal_override:
          type: string
        context_snapshot:
          type: object
          additionalProperties: {}
        metadata:
          type: object
          additionalProperties: {}
        auto_generate:
          type: boolean
          default: true
        reset_existing:
          type: boolean
          default: true
    CreateStudyDayResponse:
      type: object
      properties:
        plan_id:
          type: string
          format: uuid
        job_id:
          type: string
          nullable: true
        day:
          $ref: '#/components/schemas/StudyDay'
      required:
      - day
      - plan_id
    DocumentIngest:
      type: object
      properties:
        id:
          type: string
          format: uuid
        title:
          type: string
          maxLength: 255
        text:
          type: string
      required:
      - text
      - title
    DocumentIngestResponse:
      type: object
      properties:
        document_id:
          type: string
          format: uuid
        chunks:
          type: integer
      required:
      - chunks
      - document_id
    GenerateDayRequest:
      type: object
      properties:
        reset_existing:
          type: boolean
          default: true
    GeneratePlanRequest:
      type: object
      properties:
        title:
          type: string
        goal_override:
          type: string
    GenerateTasksRequest:
      type: object
      properties:
        section_id:
          type: string
      required:
      - section_id
    JobStatus:
      type: object
      properties:
        job_id:
          type: string
        status:
          type: string
        result:
          type: object
          additionalProperties: {}
          nullable: true
        error:
          type: string
      required:
      - job_id
      - status
    Login:
      type: object
      properties:
        username:
          type: string
        password:
          type: string
      required:
      - password
      - username
    LoginResponse:
      type: object
      properties:
        detail:
          type: string
        has_user_context:
          type: boolean
      required:
      - detail
      - has_user_context
    PlanMaterialUpload:
      type: object
      properties:
        title:
          type: string
        file:
          type: string
          format: uri
      required:
      - file
    PlanMaterialUploadResponse:
      type: object
      properties:
        document_id:
          type: string
          format: uuid
        chunks:
          type: integer
        file_id:
          type: string
          format: uuid
      required:
      - chunks
      - document_id
      - file_id
    RefreshResponse:
      type: object
      properties:
        detail:
          type: string
      required:
      - detail
    RoleEnum:
      enum:
      - user
      - assistant
      - system
      type: string
      description: |-
        * `user` - user
        * `assistant` - assistant
        * `system` - system
    SearchResult:
      type: object
      properties:
        text:
          type: string
        score:
          type: number
          format: double
      required:
      - score
      - text
    StatusEnum:
      enum:
      - pending
      - ready
      - in_progress
      - completed
      type: string
      description: |-
        * `pending` - pending
        * `ready` - ready
        * `in_progress` - in_progress
        * `completed` - completed
    StudyContext:
      type: object
      properties:
        plan_label:
          type: string
          maxLength: 120
        start_date:
          type: string
          format: date
          nullable: true
        end_date:
          type: string
          format: date
          nullable: true
        persona:
          type: string
          maxLength: 20
        goal:
          type: string
          maxLength: 100
        deadline:
          type: string
          format: date
        weekly_time_hours:
          type: integer
          maximum: 2147483647
          minimum: -2147483648
        study_routine:
          type: string
        background_level:
          type: string
          maxLength: 2000
        self_assessment:
          nullable: true
        diagnostic_status:
          type: string
          nullable: true
          maxLength: 20
        diagnostic_snapshot:
          nullable: true
        interests: {}
        preferences_formats: {}
        preferences_language:
          type: string
          maxLength: 50
        preferences_accessibility: {}
        tech_device:
          type: string
          maxLength: 100
        tech_connectivity:
          type: string
          maxLength: 100
        notifications:
          type: string
          maxLength: 100
        consent_lgpd:
          type: boolean
        materials:
          type: array
          items:
            type: string
            format: uuid
      required:
      - background_level
      - deadline
      - goal
      - notifications
      - persona
      - preferences_language
      - study_routine
      - tech_connectivity
      - tech_device
      - weekly_time_hours
    StudyDay:
      type: object
      properties:
        id:
          type: string
          format: uuid
        day_index:
          type: integer
        scheduled_date:
          type: string
          format: date
          nullable: true
        title:
          type: string
        focus:
          type: string
        target_minutes:
          type: integer
        status:
          type: string
        section_id:
          type: string
          nullable: true
          readOnly: true
        prerequisites:
          type: array
          items:
            type: string
          readOnly: true
        week_index:
          type: integer
          nullable: true
          readOnly: true
        tasks:
          type: array
          items:
            $ref: '#/components/schemas/StudyTask'
        metadata:
          type: object
          additionalProperties: {}
        generation_status:
          type: string
          nullable: true
          readOnly: true
        job_id:
          type: string
          nullable: true
          readOnly: true
        last_error:
          type: string
          nullable: true
          readOnly: true
      required:
      - day_index
      - focus
      - generation_status
      - id
      - job_id
      - last_error
      - metadata
      - prerequisites
      - scheduled_date
      - section_id
      - status
      - target_minutes
      - tasks
      - title
      - week_index
    StudyDayResult:
      type: object
      properties:
        status:
          $ref: '#/components/schemas/StatusEnum'
        minutes_spent:
          type: integer
          minimum: 0
        score:
          type: number
          format: double
        notes:
          type: string
        payload:
          type: object
          additionalProperties: {}
    StudyPlan:
      type: object
      properties:
        id:
          type: string
          format: uuid
        title:
          type: string
        summary:
          type: string
        status:
          type: string
        start_date:
          type: string
          format: date
          nullable: true
        end_date:
          type: string
          format: date
          nullable: true
        total_days:
          type: integer
        metadata:
          type: object
          additionalProperties: {}
        weeks:
          type: array
          items:
            $ref: '#/components/schemas/StudyWeek'
        days:
          type: array
          items:
            $ref: '#/components/schemas/StudyDay'
        rag_document_ids:
          type: array
          items:
            type: string
            format: uuid
        generation_status:
          type: string
        last_error:
          type: string
        job_id:
          type: string
          nullable: true
      required:
      - days
      - end_date
      - generation_status
      - id
      - job_id
      - last_error
      - metadata
      - rag_document_ids
      - start_date
      - status
      - summary
      - title
      - total_days
      - weeks
    StudyPlanSummary:
      type: object
      properties:
        id:
          type: string
          format: uuid
        title:
          type: string
        status:
          type: string
        generation_status:
          type: string
        last_error:
          type: string
        job_id:
          type: string
          nullable: true
        summary:
          type: string
        total_days:
          type: integer
        current_week:
          type: string
          readOnly: true
        generated_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
      required:
      - current_week
      - generated_at
      - generation_status
      - id
      - job_id
      - last_error
      - status
      - summary
      - title
      - total_days
      - updated_at
    StudyPlanWeekOverview:
      type: object
      properties:
        plan_id:
          type: string
          format: uuid
        weeks:
          type: array
          items:
            $ref: '#/components/schemas/StudyWeek'
      required:
      - plan_id
      - weeks
    StudyTask:
      type: object
      properties:
        id:
          type: string
          format: uuid
        day:
          type: string
          format: uuid
        order:
          type: integer
        task_type:
          type: string
        status:
          type: string
        title:
          type: string
        description:
          type: string
        duration_minutes:
          type: integer
        resources:
          type: array
          items:
            type: object
            additionalProperties: {}
        section_id:
          type: string
          nullable: true
          readOnly: true
        difficulty:
          type: integer
          nullable: true
          readOnly: true
        research_needed:
          type: boolean
          nullable: true
          readOnly: true
        content_type:
          type: string
          nullable: true
          readOnly: true
        content:
          type: object
          additionalProperties: {}
          readOnly: true
        metadata:
          type: object
          additionalProperties: {}
      required:
      - content
      - content_type
      - day
      - description
      - difficulty
      - duration_minutes
      - id
      - metadata
      - order
      - research_needed
      - resources
      - section_id
      - status
      - task_type
      - title
    StudyWeek:
      type: object
      properties:
        id:
          type: string
          format: uuid
        week_index:
          type: integer
        title:
          type: string
        focus:
          type: string
        start_date:
          type: string
          format: date
          nullable: true
        end_date:
          type: string
          format: date
          nullable: true
        status:
          type: string
        metadata:
          type: object
          additionalProperties: {}
        days:
          type: array
          items:
            $ref: '#/components/schemas/StudyDay'
      required:
      - days
      - end_date
      - focus
      - id
      - metadata
      - start_date
      - status
      - title
      - week_index
    TaskProgressRequest:
      type: object
      properties:
        status:
          $ref: '#/components/schemas/StatusEnum'
        minutes_spent:
          type: integer
          minimum: 0
          default: 0
        notes:
          type: string
          nullable: true
        payload:
          type: object
          additionalProperties: {}
      required:
      - status
    UserRead:
      type: object
      properties:
        id:
          type: string
          format: uuid
          readOnly: true
        username:
          type: string
          title: Usuário
          description: Obrigatório. 150 caracteres ou menos. Letras, números e @/./+/-/_
            apenas.
          pattern: ^[\w.@+-]+$
          maxLength: 150
        email:
          type: string
          format: email
          title: Endereço de email
          maxLength: 254
        first_name:
          type: string
          title: Primeiro nome
          maxLength: 150
        last_name:
          type: string
          title: Último nome
          maxLength: 150
      required:
      - id
      - username
    UserWrite:
      type: object
      properties:
        username:
          type: string
          title: Usuário
          description: Obrigatório. 150 caracteres ou menos. Letras, números e @/./+/-/_
            apenas.
          pattern: ^[\w.@+-]+$
          maxLength: 150
        email:
          type: string
          format: email
          title: Endereço de email
          maxLength: 254
        first_name:
          type: string
          title: Primeiro nome
          maxLength: 150
        last_name:
          type: string
          title: Último nome
          maxLength: 150
        password:
          type: string
          writeOnly: true
      required:
      - password
      - username
  securitySchemes:
    cookieAuth:
      type: apiKey
      in: cookie
      name: access_token
      description: JWT authentication with HttpOnly cookies
